<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add New Account</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,400,700">
    <link rel="stylesheet" th:href="@{/fonts/icomoon/style.css}">

    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/magnific-popup.css}">
    <link rel="stylesheet" th:href="@{/css/jquery-ui.css}">
    <link rel="stylesheet" th:href="@{/css/owl.carousel.min.css}">
    <link rel="stylesheet" th:href="@{/css/owl.theme.default.min.css}">


    <link rel="stylesheet" th:href="@{/css/aos.css}">

    <link rel="stylesheet" th:href="@{/css/style.css}">

    <style>
        /* Sembunyikan form atribut secara default */
        .form-atribut {
            display: none;
        }

        /* Menampilkan atribut ketika tab aktif */
        .tab-content.active .form-atribut {
            display: block;
        }
    </style>
</head>
<body>
<div class="site-wrap">
    <!-- Header Admin-->
    <header class="site-navbar" role="banner">
        <div class="site-navbar-top">
            <div class="container">
                <div class="row align-items-center">

                    <div class="col-12 mb-3 mb-md-0 col-md-3 order-1 order-md-1 text-md-left text-center">
                        <div class="site-logo">
                            <a href="index.html" class="js-logo-clone">Shoppers</a>
                        </div>
                    </div>

                    <div class="col-6 col-md-6 order-2 order-md-2 site-search-icon text-center border-0">
                        <h3 class="h2 text-black">User Management</h3>
                    </div>


                    <div class="col-6 col-md-3 order-3 order-md-3 text-right">
                        <div class="site-top-icons">
                            <ul>
                                <!-- jika belum login-->
                                <li><a href="#"><strong>LOGIN</strong></a></li>
                                <!-- jika sudah login-->
                                <li><a href="#"><span class="icon icon-person"></span></a></li>
                                <li><a href="#"><span class="icon icon-sign-out"></span></span></a></li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <nav class="site-navigation text-right text-md-center" role="navigation">
            <div class="container">
                <ul class="site-menu js-clone-nav d-none d-md-block">
                    <li class=""><a href="coba_admin_dashboard.html">Dashboard</a></li>
                    <li class=""><a href="admin_list_product_category.html">Product</a></li>
                    <li class="active"><a href="admin_list_user.html">User</a></li>
                    <li class=""><a href="#">Transaction</a></li>
                    <li class=""><a href="#">Report</a></li>

                </ul>
            </div>
        </nav>
    </header>

    <!--Content-->
    <div class="container mb-5 mb-md-5">
        <h3 class="mb-4 text-black">Edit User</h3>

        <!--TAB-->
        <ul class="nav nav-tabs" id="adminTab" role="tablist">
            <li class="nav-item" onclick="showTab('account')">
                <a class="nav-link active" id="account-tab" data-toggle="tab" href="#products" role="tab"
                   aria-controls="accounts" aria-selected="true">Accounts</a>
            </li>
            <li class="nav-item" onclick="showTab('profile')">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#categories" role="tab"
                   aria-controls="categories" aria-selected="false">Profile</a>
            </li>
            <li class="nav-item" onclick="showTab('roles')">
                <a class="nav-link" id="roles-tab" data-toggle="tab" href="#accounts" role="tab"
                   aria-controls="accounts" aria-selected="false">Role</a>
            </li>
        </ul>

        <!--TAB Content-->
        <!--        <div class="tab-content" id="adminTabContent">-->
        <!--            <div class="tab-pane fade show active" id="products" role="tabpanel" aria-labelledby="account-tab">-->
        <!--                <h2>Existing Accounts</h2>-->
        <!--                <a href="admin_add_user.html" class="btn btn-primary mb-3">Add Account</a>-->
        <!--                <ul id="tesytList" class="list-group">-->
        <!--                    &lt;!&ndash; Existing accounts will be listed here &ndash;&gt;-->
        <!--                    <li class="list-group-item">user2 (user2@example.com)</li>-->
        <!--                </ul>-->
        <!--            </div>-->
        <!--            <div class="tab-pane fade" id="categories" role="tabpanel" aria-labelledby="profile-tab">-->
        <!--                <h2>Existing Categories</h2>-->
        <!--                <a href="add-category.html" class="btn btn-primary mb-3">Add Category</a>-->
        <!--                <ul id="categoryList" class="list-group">-->
        <!--                    &lt;!&ndash; Existing categories will be listed here &ndash;&gt;-->
        <!--                    <li class="list-group-item">user2 (user2@example.com)</li>-->
        <!--                </ul>-->
        <!--            </div>-->
        <!--            <div class="tab-pane fade" id="accounts" role="tabpanel" aria-labelledby="roles-tab">-->
        <!--                <h2>Existing Accounts</h2>-->
        <!--                <a href="admin_add_user.html" class="btn btn-primary mb-3">Add Account</a>-->
        <!--                <ul id="accountList" class="list-group">-->
        <!--                    &lt;!&ndash; Existing accounts will be listed here &ndash;&gt;-->
        <!--                    <li class="list-group-item">user2 (user2@example.com)</li>-->
        <!--                </ul>-->
        <!--            </div>-->
        <!--        </div>-->

        <form class="mt-3 mt-md-3" id="accountForm"
              th:action="@{/admin/user-edit/{userId}(userId=${existingUser.getId()})}" method="post"
              th:object="${existingUser}">
            <div class="tab-content" id="tabaccount-content">
                <div class="form-group form-atribut">
                    <label for="username">Username <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="username" name="username"
                           placeholder="Enter username"
                           th:field="*{username}"
                           disabled>
                </div>
                <div class="form-group form-atribut">
                    <label for="email">Email <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Enter email"
                           th:field="*{email}" required>
                </div>
                <div class="form-group form-atribut">
                    <label for="phoneNumber">Phone number <span class="text-danger">*</span></label>
                    <input type="number" class="form-control" id="phoneNumber" name="phoneNumber" min="0"
                           placeholder="Enter phone number"
                           th:field="*{phoneNumber}" required>
                </div>
            </div>

            <div class="tab-content" id="tabprofile-content">
                <div class="form-group form-atribut">
                    <label for="firstname">Firstname <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="firstname" name="firstname"
                           placeholder="Enter firstname"
                           th:field="*{profile.firstName}">
                </div>
                <div class="form-group form-atribut">
                    <label for="lastname">Lastname <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="lastname" name="lastname"
                           placeholder="Enter lastname"
                           th:field="*{profile.lastName}">
                </div>
                <div class="form-group form-atribut">
                    <label for="gender">Gender <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="gender" name="gender"
                           placeholder="Enter gender"
                           th:field="*{profile.gender}">
                </div>
                <div class="form-group form-atribut">
                    <label for="dateOfBirth">Date of birth <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth"
                           placeholder="Enter dateOfBirth"
                           th:field="*{profile.dateOfBirth}">
                </div>
            </div>

            <div class="tab-content" id="tabroles-content">
                <div class="form-group form-atribut">
                    <label for="role">Role <span class="text-danger">*</span></label>
                    <select id="role" class="form-control form-select" name="role" aria-label="select role"
                            onchange="autoCheckCategories()">
                        <option hidden disabled selected value>Select role</option>
                        <option th:each="rl : ${listRole}" th:value="${rl.getName()}" th:text="${rl.getName()}"
                                th:selected="${existingUser.getRole().equals(rl.name)}"></option>
                    </select>
                </div>

                <div class="form-group  form-atribut">
                    <label>Permission <span class="text-danger">*</span></label>
                    <div class="form-check" th:each="hak:${permissions}">
                        <input class="form-check-input" type="checkbox" th:id="'permission-'+${hak.getID()}"
                               th:value="${hak.getID()}" th:field="*{permissionId}">
                        <label class="form-check-label" th:for="'permission-'+${hak.getID()}"
                               th:text="${hak.getName()}"></label>
                    </div>
                </div>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Save</button>
        </form>


    </div>

    <!--Footer-->
    <footer class="site-footer border-top">
        <div class="container">

            <div class="row pt-5 mt-5 text-center">
                <div class="col-md-12">
                    <p>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        Copyright &copy;<script data-cfasync="false"
                                                src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
                        <script>document.write(new Date().getFullYear());</script>
                        All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i>
                        by <a href="https://colorlib.com" target="_blank" class="text-primary">Colorlib</a>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </p>
                </div>

            </div>
        </div>
    </footer>
</div>


<script th:src="@{/js/jquery-3.3.1.min.js}"></script>
<script th:src="@{/js/jquery-ui.js}"></script>
<script th:src="@{/js/popper.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/js/owl.carousel.min.js}"></script>
<script th:src="@{/js/jquery.magnific-popup.min.js}"></script>
<script th:src="@{/js/aos.js}"></script>
<script th:src="@{/js/main.js}"></script>

<!-- JavaScript to auto-check categories v2 -->
<script th:inline="javascript">
    // Dynamically pass category-itemType mapping from Thymeleaf, data var rolePermissionMap diambil dari map rolePermissionMap di controller
    const rolePermissionMap = /*[[${rolePermissionMap}]]*/ {};

    function autoCheckCategories() {
        console.log(rolePermissionMap)
        const itemType = document.getElementById("role").value; // Get selected item type
        console.log(itemType)
        const permissionCheckboxes = document.querySelectorAll('input[type="checkbox"]');

        // Uncheck all categories first
        permissionCheckboxes.forEach(checkbox => {
            checkbox.checked = false;
        });

        // Check categories based on selected item type
        if (itemType && rolePermissionMap[itemType]) {
            const selectedPermissionIds = rolePermissionMap[itemType];
            selectedPermissionIds.forEach(permissionId => {
                const checkbox = document.getElementById(`permission-${permissionId}`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
        }
    }
</script>
<script>
    function showTab(tab) {
        hideAll()

        // // Menampilkan tab yang dipilih
        document.getElementById(`${tab}-tab`).classList.add('active');
        document.getElementById(`tab${tab}-content`).classList.add('active');
    }

    function hideAll() {
        const tabs = document.querySelectorAll('.nav-link') //diambil bedasarkan kelas
        // console.log(tabs);
        const tabContent = document.querySelectorAll('.tab-content')
        // console.log(tabContent);

        tabs.forEach(tab => tab.classList.remove('active'));
        tabContent.forEach(content => content.classList.remove('active'));
    }

    showTab('account')
</script>
</body>
</html> 